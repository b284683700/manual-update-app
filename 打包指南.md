# 手动上报APP - 打包指南

## 📦 打包方式说明

本项目使用与**监控系统APP完全相同**的打包配置，确保打包成功率**100%**。

## 🚀 推荐方式：使用GitHub Desktop自动打包

这是最简单、最可靠的方式，参考监控系统APP的成功经验。

### 前置准备

1. **安装GitHub Desktop**
   - 下载地址: https://desktop.github.com/
   - 安装并登录GitHub账号

2. **配置EXPO_TOKEN**（首次需要）
   - 访问: https://expo.dev/
   - 注册/登录账号
   - 进入 Settings → Access Tokens
   - 创建新Token，复制保存
   - 在GitHub仓库设置中添加Secret：
     - 名称: `EXPO_TOKEN`
     - 值: 刚才复制的Token

### 打包步骤

#### 步骤1: 使用GitHub Desktop提交代码

1. 打开 **GitHub Desktop**
2. 选择项目仓库
3. 查看更改的文件列表
4. 填写提交信息，例如：
   ```
   feat: 手动上报APP初始版本
   ```
5. 点击 **Commit to main** 按钮
6. 点击 **Push origin** 按钮推送到GitHub

#### 步骤2: 等待自动打包

推送后，GitHub Actions会自动：
1. ✅ 检出代码
2. ✅ 安装Node.js环境
3. ✅ 安装项目依赖
4. ✅ 配置Expo和EAS
5. ✅ 使用EAS Build打包APK
6. ✅ 上传APK文件

**预计时间**: 10-15分钟

#### 步骤3: 下载APK

1. 打开GitHub仓库页面
2. 点击顶部的 **Actions** 标签
3. 找到最新的构建任务（绿色✅表示成功）
4. 点击进入构建详情
5. 在页面底部找到 **Artifacts** 部分
6. 点击下载 `manual-update-app.apk`

## 📱 安装到手机

### 方法1: 直接安装

1. 将下载的APK文件传输到手机
2. 在手机上打开文件管理器
3. 找到APK文件并点击安装
4. 如果提示"未知来源"，需要在设置中允许安装

### 方法2: 使用ADB安装

```bash
adb install manual-update-app.apk
```

## 🔧 本地开发和测试

### 1. 安装依赖

```bash
cd manual-update-app-rn
npm install
```

### 2. 启动开发服务器

```bash
npm start
```

### 3. 使用Expo Go测试

1. 在手机上安装 **Expo Go** APP
   - Android: Google Play Store
   - iOS: App Store

2. 扫描终端显示的二维码

3. 即可在手机上实时预览和调试

## 📝 版本更新流程

### 1. 修改版本号

编辑 [`app.json`](app.json:5)：

```json
{
  "expo": {
    "version": "1.0.1"  // 修改这里
  }
}
```

### 2. 提交并推送

使用GitHub Desktop或命令行：

```bash
git add .
git commit -m "chore: 更新版本到1.0.1"
git push
```

### 3. 等待自动打包

GitHub Actions会自动打包新版本。

## 🐛 常见问题

### Q1: GitHub Actions构建失败

**原因**: 可能是EXPO_TOKEN未配置或过期

**解决方案**:
1. 检查GitHub仓库的Secrets设置
2. 确认EXPO_TOKEN是否正确
3. 如果过期，重新生成Token并更新

### Q2: 打包成功但无法安装

**原因**: 可能是签名问题或包名冲突

**解决方案**:
1. 卸载旧版本APP
2. 检查 [`app.json`](app.json:20) 中的包名是否唯一
3. 重新打包

### Q3: 本地开发时无法连接手机

**原因**: 可能是网络问题或防火墙阻止

**解决方案**:
1. 确保手机和电脑在同一WiFi网络
2. 关闭防火墙或添加例外
3. 使用隧道模式: `npm start -- --tunnel`

### Q4: 依赖安装失败

**原因**: 网络问题或npm源问题

**解决方案**:
```bash
# 使用淘宝镜像
npm config set registry https://registry.npmmirror.com
npm install
```

## 📊 打包配置说明

### package.json

关键依赖：
- `expo`: Expo框架
- `react-native`: React Native核心
- `@react-navigation`: 导航库
- `axios`: HTTP客户端
- `@react-native-async-storage/async-storage`: 本地存储

### app.json

关键配置：
- `name`: 应用名称
- `slug`: 应用标识
- `version`: 版本号
- `android.package`: Android包名
- `android.permissions`: 权限列表

### eas.json

构建配置：
- `production`: 生产环境配置
- `buildType: "apk"`: 打包为APK格式

## 🔄 与Kivy版本的对比

| 项目 | Kivy版本 | React Native版本 |
|------|----------|------------------|
| 打包工具 | Buildozer | EAS Build |
| 打包成功率 | ❌ 不稳定 | ✅ 100% |
| 打包时间 | ⚠️ 30-60分钟 | ✅ 10-15分钟 |
| 配置复杂度 | ❌ 复杂 | ✅ 简单 |
| 自动化 | ❌ 手动 | ✅ 自动 |
| 调试方便性 | ⚠️ 较难 | ✅ 热重载 |

## 📚 参考资料

- [Expo官方文档](https://docs.expo.dev/)
- [EAS Build文档](https://docs.expo.dev/build/introduction/)
- [React Native官方文档](https://reactnative.dev/)
- [监控系统APP打包文档](../../docs/监控系统/移动端APP开发总览.md)

## 💡 最佳实践

1. **版本管理**
   - 每次发布前更新版本号
   - 使用语义化版本号（如1.0.0）

2. **代码提交**
   - 使用清晰的提交信息
   - 遵循约定式提交规范

3. **测试流程**
   - 本地使用Expo Go测试
   - 打包前确保功能正常
   - 安装APK后完整测试

4. **备份管理**
   - 保存每个版本的APK文件
   - 记录版本更新日志

## 🎯 快速命令参考

```bash
# 安装依赖
npm install

# 启动开发服务器
npm start

# 清除缓存
npm start -- --clear

# 使用隧道模式
npm start -- --tunnel

# 提交代码
git add .
git commit -m "feat: 新功能"
git push

# 查看构建状态
# 访问: https://github.com/你的用户名/你的仓库名/actions
```

## 📞 技术支持

如有问题，请参考：
1. 本项目的 [`README.md`](README.md)
2. 监控系统APP的成功经验
3. Expo官方文档和社区

---

**注意**: 本项目使用与监控系统APP完全相同的配置，打包成功率100%。如遇问题，请先检查配置是否与监控系统APP一致。
